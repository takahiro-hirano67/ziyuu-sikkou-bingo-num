# 景品番号管理アプリ (Bingo Num App)

イベント（ビンゴ大会など）で使用する景品の引換番号と、対応する景品名を管理するためのWebアプリケーションです。

<img width="745" height="980" alt="image" src="https://github.com/user-attachments/assets/448769a8-a333-4b7f-b2f5-db08797cbc49" />

## 開発の背景と課題意識

従来の手作業によるビンゴの番号割り当てでは、以下のような問題点がありました。

* **人数の変動への対応:** イベントの「参加人数 < 景品数」となる場合が多く、目玉景品を確実に排出するための手動調整（10人参加の場合の配置、11人の場合の配置…など）が非常に煩雑でした。
* **人為的ミスの発生:** 当日の想定外の人数変動に対し、その場で手動で番号を割り当て直す必要があり、設定箇所の多さからミスを完全に防ぐことが困難でした。

本アプリは、これらの「管理の煩雑さ」と「人為的なオペレーションミス」を**プログラムによって完全に防ぎ、公平かつ確実なイベント運営を実現するため**に開発されました。

---

## イベント運営のアプローチ（仕様の前提）

本アプリでは、エラーや矛盾を防ぐため **`参加者数 ≧ 景品数` である場合のみ**処理を実行できるという厳格な仕様を設けています。

イベント当日に「参加人数 < 景品数」となった場合は、**本番その場で景品数と参加者数を物理的に合わせる**（景品を除外する）アプローチを取ります。

**【当日の進行例】**
> 「今回は想定よりも参加人数が少ないため、比較的に価値の低い景品はプールから除外し、次回以降のイベントに持ち越します。除外予定の景品の中で、今回のビンゴに含めたいものはありますか？」

このように参加者の前で確認を取り、除外設定を行うことで、システム上でも現実でも「参加者数 ≧ 景品数」の状態を担保します。（※食品やシーズンアイテム、高額・人気景品は優先的に残すなどの運用ルールと併用します）

**【現行仕様の制限（デメリット）】**
* 1人につき最大1点の当選となります（1人2点当選は不可/システムで意図的に想定していない）。
* 参加者数 ＜ 景品数の場合、参加者の目の前で景品を除外するプロセスが発生します。

---

## 主な特徴と操作フロー

処理の流れを4つのステップに分け、SPA（シングルページアプリケーション）として直感的に操作できます。

1. **Step 1: 景品入力**
   景品リストを改行区切りで入力します。
2. **Step 2: 人数入力 & 調整**
   参加人数を入力し、景品リストの発表順をドラッグ＆ドロップで並べ替えます。参加人数より景品が多い場合は、景品を「除外」して数を調整します。
3. **Step 3: 番号選択**
   ビンゴした人が選んだ引換番号をクリックして選択状態にし、メモ（当選者名や学籍番号など）を記録します。
4. **Step 4: 景品発表**
   発表順リストをクリックすることで、対応する引換番号と景品名が公開されます。

---

## 主な用語について

* **景品数 / 参加人数:** ビンゴ開始前に必ず再確認します。途中参加は仕様上不可能です。
* **引換番号:** 1～有効な景品数までの番号。ビンゴした人は一度だけ選択可能です。
* **当選番号 (内部処理):** 引換番号に対応してランダムに割り当てられる番号。景品発表の際に初めて判明します。

---

## 公平性について

引換番号と景品を紐付ける処理には、**Fisher-Yates shuffle**（フィッシャー・イェーツのシャッフル）アルゴリズムを採用し、完全な公平性を確保しています。

これは現実の「くじ引き（箱の中にすべての番号札を入れて見えないように混ぜ、1枚ずつ引いていく）」と全く同じことをプログラムで行う手法です。特定の番号が出やすくなるような偏り（バイアス）は数学的に発生しません。

※ 当選番号の処理に疑問がある場合は、本リポジトリのソースコード（`utils/shuffle.ts` 等）をご参照ください。

---

## 技術スタック

本アプリケーションはフロントエンドのみで構成され、状態管理にはReact Hooks（`useState`, `useMemo`）を活用しています。

* **フレームワーク:** Next.js (App Router)
* **言語:** TypeScript
* **スタイリング:** Tailwind CSS
* **主要ライブラリ:**
  * `@dnd-kit/core`, `@dnd-kit/sortable`: ドラッグ＆ドロップによる並べ替え機能
  * `@heroicons/react`: UIアイコン
  * `react-use`: 誤リロード防止機能（`useBeforeUnload`）

---

## セットアップと実行方法

1. リポジトリをクローンします:
```bash
git clone [リポジトリURL]
cd [リポジトリ名]/bingo-num-app
```

2. 依存関係をインストールします:
```bash
npm install
```

3. 開発サーバーを起動します:
```bash
npm run dev
```

4. ブラウザで `http://localhost:3000` にアクセスします。

## デプロイ

このアプリケーションはNext.jsプロジェクトとして、Vercelへのデプロイに最適化されています。

## 補足

- `localStorage` による値の保持は、アプリの規模と目的からしてオーバーエンジニアリングとなるため実装していません。
  - また、値を保持できると都合のいい状態で保持してウィンドウを差し替えることも可能となるため、公平性の観点からも不要だと判断しています。

## ディレクトリ構成

保守性と可読性を高めるため、機能や責務ごとにファイルを分割しています。

```text
ziyuu-sikkou-bingo-num
├─ bingo-num-app
│  ├─ app
│  │  ├─ layout.tsx
│  │  └─ page.tsx             # メインのオーケストレーター
│  ├─ components
│  │  └─ steps                # 各ステップのUIコンポーネント
│  │     ├─ PrizeInputStep.tsx
│  │     ├─ PeopleInputStep.tsx
│  │     ├─ SelectPrizeNumStep.tsx
│  │     └─ AnnouncePrizeStep.tsx
│  ├─ hooks
│  │  └─ useBingoState.ts     # 状態管理とビジネスロジック
│  ├─ types
│  │  └─ index.ts             # 型定義
│  └─ utils
│     └─ shuffle.ts           # シャッフルなどの純粋関数
```
